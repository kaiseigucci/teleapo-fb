# 要件定義書：テレアポFB君

**バージョン**: 1.0  
**作成日**: 2025年10月24日  
**最終更新日**: 2025年10月24日

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
テレアポFB君（テレアポフィードバック君）

### 1.2 目的
テレアポ担当者の営業スキル向上を支援するため、音声データを自動分析し、各会話の成果判定と改善点を提示するAIシステムを構築する。

### 1.3 ターゲットユーザー
- テレアポ営業担当者
- テレアポチームのマネージャー・トレーナー
- 営業代行会社

### 1.4 期待される効果
- テレアポの成功率向上
- 新人育成の効率化
- 客観的なフィードバックによるスキルアップ
- PDCAサイクルの高速化

---

## 2. システム概要

### 2.1 システムの全体像
テレアポの音声ファイルをWebからアップロードし、AIが自動で以下を実行：
1. 音声の文字起こし
2. 1件1件の会話に自動分割
3. 各会話の成果判定（アポ獲得/資料送付/担当者接続/受付突破失敗）
4. 失敗した会話に対する改善点の提示

### 2.2 処理フロー
```
[音声ファイル] 
  ↓ (アップロード)
[一時ストレージ保存]
  ↓
[音声認識API] → [テキストデータ]
  ↓
[会話分割処理] → [会話1, 会話2, ..., 会話N]
  ↓
[LLM分析] → [成果判定 + 改善点抽出]
  ↓
[データベース保存]
  ↓
[ダッシュボード表示]
```

---

## 3. 機能要件

### 3.1 優先度定義
- **P0（必須）**: MVP（最小限の製品）に必須の機能
- **P1（高）**: 早期に実装すべき機能
- **P2（中）**: 将来的に実装する機能
- **P3（低）**: 必要に応じて実装する機能

### 3.2 機能一覧

#### 3.2.1 音声アップロード機能【P0】

**機能概要**  
ユーザーがテレアポの音声ファイルをWebブラウザからアップロードできる。

**詳細要件**
- 対応ファイル形式：MP3, WAV, M4A
- 最大ファイルサイズ：1GB
- 最大録音時間：3時間
- ドラッグ&ドロップ対応
- アップロード進捗の表示
- アップロード後、自動で分析開始

**入力**
- 音声ファイル（MP3/WAV/M4A）
- オプション：ファイル名（自動入力も可）

**出力**
- アップロード成功/失敗メッセージ
- 分析開始通知
- ジョブID（分析状況追跡用）

**バリデーション**
- ファイル形式チェック
- ファイルサイズチェック
- 音声ファイルの破損チェック

---

#### 3.2.2 音声認識・文字起こし機能【P0】

**機能概要**  
OpenAI Whisper APIを使用して、音声を高精度でテキスト化する。

**詳細要件**
- 日本語音声に対応
- タイムスタンプ付きテキスト生成
- 処理時間：音声時間の5〜10%以内（3時間 → 10分以内）
- コスト効率が良い（$0.006/分）

**処理仕様**
- OpenAI Whisper API使用
- モデル：`whisper-1`
- 言語：日本語（自動検出または明示的に指定）
- レスポンス形式：`verbose_json`（タイムスタンプ付き）
- ファイル分割：25MB以上のファイルは分割して処理

**入力**
- 音声ファイル（ストレージURL経由でダウンロード）

**出力**
- 文字起こしテキスト（JSON形式）
- セグメント情報（発言ごとのタイムスタンプ）
- 言語検出結果

---

#### 3.2.3 会話分割機能【P0】

**機能概要**  
文字起こしされた長時間の音声を、1件1件の電話（会話単位）に自動で分割する。

**詳細要件**
- 会話の開始：「お世話になっております」「もしもし」「〇〇と申します」等
- 会話の終了：「ありがとうございました」「失礼いたします」等
- 話者の切り替わりを考慮（顧客が変わったら新しい会話）
- 沈黙時間（30秒以上）も会話の区切りとして考慮

**分割ロジック**
1. 挨拶パターンのマッチング（正規表現 + LLM判定）
2. 話者の切り替わり検出
3. 長時間の沈黙検出
4. 会話時間が極端に短い場合の除外（30秒未満は誤検知として除外）

**入力**
- 文字起こしテキスト
- 話者情報
- タイムスタンプ

**出力**
- 会話配列（会話1, 会話2, ..., 会話N）
- 各会話のメタデータ（開始時間、終了時間、話者情報）

---

#### 3.2.4 成果判定機能【P0】

**機能概要**  
各会話に対して、LLMを使用して成果指標を自動判定する。

**判定カテゴリ**
1. **アポ獲得**：商談・打ち合わせのアポイントが取れた
2. **資料送付**：資料送付の承諾を得た
3. **担当者接続**：キーパーソン（担当者）との通話に成功した
4. **受付突破失敗**：受付で断られた、担当者に繋がらなかった

**判定ロジック**
- Google Gemini API（Gemini 1.5 Flash）を使用
- プロンプトに会話テキストを入力し、4カテゴリのいずれかを判定
- 信頼度スコア（0〜100%）も併せて出力

**入力**
- 会話テキスト

**出力**
- 成果カテゴリ（enum: APPOINTMENT, DOCUMENT_SENT, CONTACT_SUCCESS, RECEPTION_FAILED）
- 信頼度スコア（0〜100）
- 判定理由（簡潔なテキスト）

---

#### 3.2.5 改善点分析機能【P0】

**機能概要**  
成果が得られなかった会話（主に「受付突破失敗」）に対して、改善すべきポイントをLLMが分析・提示する。

**分析カテゴリ**
1. **冒頭トーク**：名乗り、挨拶、つかみの部分
2. **ヒアリング**：顧客のニーズや状況の聞き出し
3. **提案・訴求**：サービス・商品の説明、ベネフィット訴求
4. **反論処理**：断り文句への対応
5. **クロージング**：アポや資料送付への誘導
6. **トーン・話し方**：声のトーン、スピード、間の取り方
7. **その他**

**分析ロジック**
- Google Gemini APIを使用
- プロンプトに会話テキストと成果判定結果を入力
- 改善カテゴリ、具体的な問題点、改善提案を出力

**入力**
- 会話テキスト
- 成果判定結果

**出力**
- 改善カテゴリ（複数可）
- 問題点の説明（テキスト）
- 具体的な改善提案（テキスト）
- 改善優先度（高/中/低）

---

#### 3.2.6 ダッシュボード機能【P0】

**機能概要**  
分析結果を視覚的にわかりやすく表示する。

**表示内容**
- 分析済み音声ファイルの一覧
- 各音声ファイルのサマリー
  - 総会話数
  - 成果別の件数（アポ獲得: X件、資料送付: Y件、等）
  - 成功率（%）
- 会話詳細リスト
  - 会話番号
  - 開始時間
  - 成果カテゴリ
  - 改善点の有無

**操作**
- 音声ファイル選択
- 会話詳細の表示
- フィルタリング（成果カテゴリ別）

---

#### 3.2.7 会話詳細表示機能【P0】

**機能概要**  
個別の会話の詳細情報を表示する。

**表示内容**
- 会話の文字起こしテキスト（話者別に色分け）
- 成果判定結果
- 改善点分析結果（該当する場合）
- タイムスタンプ

---

#### 3.2.8 音声ファイル自動削除機能【P0】

**機能概要**  
プライバシー保護とストレージコスト削減のため、音声ファイルを自動削除する。

**詳細要件**
- アップロードから24時間後に自動削除
- 削除前に通知は不要
- 文字起こしテキストと分析結果はデータベースに永続保存

---

#### 3.2.9 会話履歴機能【P1】

**機能概要**  
過去にアップロードした音声ファイルの履歴を一覧表示する。

**表示内容**
- アップロード日時
- ファイル名
- 総会話数
- 成功率
- 詳細へのリンク

---

#### 3.2.10 統計・分析機能【P2】

**機能概要**  
複数の音声ファイルをまたいだ統計情報を表示する。

**表示内容**
- 期間別の成功率推移
- よくある失敗パターン
- 改善カテゴリ別の頻度
- 平均通話時間

---

## 4. 非機能要件

### 4.1 パフォーマンス要件

| 項目 | 要件 |
|-----|-----|
| 音声アップロード時間 | 1GBを5分以内 |
| 文字起こし処理時間 | 音声時間の5〜10%以内（3時間 → 10分以内） |
| 会話分割処理時間 | 1分以内 |
| LLM分析処理時間 | 1会話あたり5秒以内 |
| ダッシュボード表示時間 | 2秒以内 |

### 4.2 スケーラビリティ要件

| 項目 | 要件 |
|-----|-----|
| 同時アップロード数 | MVP時点では1〜3（将来的に10以上） |
| ユーザー数 | MVP時点では1〜10名（将来的に100名以上） |
| データ保存期間 | 音声：24時間、分析結果：無期限 |

### 4.3 可用性要件

| 項目 | 要件 |
|-----|-----|
| 稼働率 | 95%以上（MVP時点） |
| メンテナンス時間 | 週1回、深夜帯に実施可能 |

### 4.4 セキュリティ要件

| 項目 | 要件 |
|-----|-----|
| 認証 | 基本認証（将来的にOAuth対応） |
| データ暗号化 | HTTPS通信必須 |
| 個人情報保護 | 音声ファイルは24時間で自動削除 |
| APIキー管理 | 環境変数で管理、Gitには含めない |

### 4.5 運用要件

| 項目 | 要件 |
|-----|-----|
| ログ | エラーログ、アクセスログを記録 |
| 監視 | Vercel標準の監視機能を使用 |
| バックアップ | データベースは自動バックアップ（Supabase標準機能） |
| エラー通知 | 処理失敗時はダッシュボード上で通知 |

### 4.6 保守性要件

| 項目 | 要件 |
|-----|-----|
| コード品質 | TypeScript使用、ESLint/Prettier設定 |
| ドキュメント | README、API仕様書、コメント |
| テスト | 単体テストは必須、E2Eテストは推奨 |

---

## 5. ユーザーストーリー

### 5.1 音声アップロード〜分析結果確認

**ユーザー**: テレアポ担当者  
**目的**: 今日のテレアポ音声を分析して、改善点を知りたい

**ストーリー**
1. ダッシュボードにアクセスする
2. 「音声をアップロード」ボタンをクリック
3. ローカルの音声ファイル（MP3, 3時間）をドラッグ&ドロップ
4. アップロード進捗が表示される
5. アップロード完了後、「分析中」のステータスが表示される
6. 5〜10分後、分析完了の通知が表示される
7. ダッシュボードで結果を確認
   - 総会話数: 45件
   - アポ獲得: 3件
   - 資料送付: 8件
   - 担当者接続: 12件
   - 受付突破失敗: 22件
8. 「受付突破失敗」の会話をクリックして詳細を確認
9. 改善点を読んで、次回のテレアポに活かす

**期待される結果**
- 客観的なフィードバックを得られる
- 自分の弱点が明確になる
- 具体的な改善アクションがわかる

---

## 6. 画面設計（概要）

### 6.1 画面一覧

| 画面ID | 画面名 | 優先度 |
|-------|-------|-------|
| SC01 | ダッシュボード画面 | P0 |
| SC02 | 音声アップロード画面（モーダル） | P0 |
| SC03 | 分析結果詳細画面 | P0 |
| SC04 | 会話詳細画面 | P0 |
| SC05 | 履歴一覧画面 | P1 |

### 6.2 画面遷移図

```
[SC01: ダッシュボード]
    ↓ (アップロードボタン)
[SC02: 音声アップロードモーダル]
    ↓ (アップロード完了)
[SC01: ダッシュボード]（分析中表示）
    ↓ (分析完了後、ファイル選択)
[SC03: 分析結果詳細]
    ↓ (会話選択)
[SC04: 会話詳細]
```

### 6.3 主要画面のワイヤーフレーム（概要）

#### SC01: ダッシュボード画面
```
+--------------------------------------------------+
|  テレアポFB君                    [アップロード]  |
+--------------------------------------------------+
| 📊 分析済みファイル一覧                          |
|                                                  |
| [最新] 2025-10-24_teleapo.mp3                   |
|   総会話数: 45件 | アポ獲得: 3件 | 成功率: 51%   |
|   [詳細を見る]                                   |
|                                                  |
| [分析中] 2025-10-23_teleapo.mp3                 |
|   処理中... (進捗: 60%)                          |
|                                                  |
| 2025-10-22_teleapo.mp3                          |
|   総会話数: 38件 | アポ獲得: 5件 | 成功率: 55%   |
|   [詳細を見る]                                   |
+--------------------------------------------------+
```

#### SC03: 分析結果詳細画面
```
+--------------------------------------------------+
|  ← 戻る    2025-10-24_teleapo.mp3               |
+--------------------------------------------------+
| 📈 サマリー                                      |
|   総会話数: 45件                                 |
|   ✅ アポ獲得: 3件 (7%)                         |
|   📄 資料送付: 8件 (18%)                        |
|   📞 担当者接続: 12件 (27%)                     |
|   ❌ 受付突破失敗: 22件 (49%)                   |
+--------------------------------------------------+
| 🗣️ 会話一覧                                     |
|                                                  |
| [フィルタ: 全て ▼]                               |
|                                                  |
| #1  09:00:15  ✅ アポ獲得                       |
| #2  09:03:42  ❌ 受付突破失敗  [改善点あり]     |
| #3  09:08:10  📞 担当者接続                     |
| ...                                              |
+--------------------------------------------------+
```

#### SC04: 会話詳細画面
```
+--------------------------------------------------+
|  ← 戻る    会話 #2 の詳細                        |
+--------------------------------------------------+
| ⏱️ 09:03:42 - 09:05:18 (1分36秒)               |
| 📊 成果: ❌ 受付突破失敗                         |
+--------------------------------------------------+
| 💬 会話内容                                      |
|                                                  |
| [担当者] お世話になっております。株式会社〇〇の  |
|          山田と申します。                        |
| [顧客]   はい。                                  |
| [担当者] 今回、新規のご提案でお電話させていただ  |
|          きました。営業部の責任者の方はいらっし  |
|          ゃいますでしょうか？                    |
| [顧客]   営業の者はおりますが、そういったお電話  |
|          はお断りしております。                  |
| [担当者] そうですか...わかりました。失礼いたし   |
|          ます。                                  |
| [顧客]   失礼します。                            |
+--------------------------------------------------+
| 💡 改善点                                        |
|                                                  |
| 🔴 【冒頭トーク】優先度: 高                      |
|   問題点: 「新規のご提案」という表現が警戒感を   |
|           与えている可能性があります。           |
|   改善案: 具体的なメリットや業界実績を最初に伝   |
|           えることで、興味を引きやすくなります。 |
|                                                  |
| 🟡 【反論処理】優先度: 中                        |
|   問題点: 「そうですか」とすぐに引き下がってし   |
|           まっています。                         |
|   改善案: 「1分だけお時間いただけませんか」等、  |
|           粘り強く対応することが重要です。       |
+--------------------------------------------------+
```

---

## 7. システム制約

### 7.1 技術的制約

| 項目 | 制約内容 |
|-----|---------|
| 実行環境 | Vercel（サーバーレス） |
| 実行時間制限 | Vercel Hobby: 10秒、Pro: 60秒 → バックグラウンド処理必須 |
| ファイルサイズ制限 | Vercel Blob: ファイルあたり500MB（Pro: 制限なし） |
| API制限 | Google Speech-to-Text: 1ファイル480分まで |
| API制限 | Google Gemini: RPM（リクエスト/分）制限あり |

### 7.2 コスト制約

- 音声認識コスト：1ファイル（3時間）あたり約$4.32
- LLMコスト：1会話あたり$0.001程度
- 月間想定コスト（10ファイル処理）：約$50〜$100

### 7.3 運用制約

- MVP段階では1ユーザーのみを想定（マルチテナント対応は不要）
- 24時間365日の運用サポートは不要

---

## 8. 外部システム連携

### 8.1 OpenAI Whisper API

**目的**: 音声認識・文字起こし  
**認証方式**: APIキー（Bearer Token）  
**エンドポイント**: `https://api.openai.com/v1/audio/transcriptions`  
**データフロー**: 音声ファイル → API → 文字起こしテキスト  
**制約事項**:
- 最大ファイルサイズ: 25MB
- 対応形式: mp3, mp4, mpeg, mpga, m4a, wav, webm
- 25MB超のファイルは分割処理が必要

### 8.2 Google Gemini API

**目的**: 会話分析、成果判定、改善点抽出  
**認証方式**: APIキー  
**データフロー**: 会話テキスト → API → 分析結果

---

## 9. データ管理

### 9.1 データ保存ポリシー

| データ種別 | 保存場所 | 保存期間 |
|-----------|---------|---------|
| 音声ファイル | Vercel Blob Storage | 24時間（自動削除） |
| 文字起こしテキスト | Supabase（PostgreSQL） | 無期限 |
| 分析結果 | Supabase（PostgreSQL） | 無期限 |

### 9.2 バックアップ

- Supabaseの自動バックアップ機能を使用
- 日次バックアップ（7日間保持）

---

## 10. リスク管理

### 10.1 想定リスクと対策

| リスク | 影響 | 発生確率 | 対策 |
|-------|------|---------|-----|
| Google APIの料金が想定より高い | コスト超過 | 中 | 処理前に料金試算を実施、アラート設定 |
| 会話分割の精度が低い | ユーザー体験低下 | 中 | パターンマッチ＋LLM判定のハイブリッド方式 |
| Vercelの実行時間制限に引っかかる | 処理失敗 | 高 | バックグラウンドジョブ（Queue）を使用 |
| 大量の音声ファイルでストレージ不足 | システムダウン | 低 | 24時間自動削除、アラート設定 |
| LLMの分析精度が低い | フィードバックの質低下 | 中 | プロンプトエンジニアリング、Few-shot学習 |

---

## 11. 成功指標（KPI）

### 11.1 MVP段階のKPI

| 指標 | 目標値 | 測定方法 |
|-----|-------|---------|
| 処理成功率 | 90%以上 | 全アップロードファイル中の成功件数 |
| 処理時間 | 10分以内（3時間音声） | システムログから計測 |
| 会話分割精度 | 85%以上 | 手動チェックによる検証 |
| ユーザー満足度 | 4/5以上 | ユーザーヒアリング |

---

## 12. 用語集

| 用語 | 説明 |
|-----|-----|
| テレアポ | 電話によるアポイントメント獲得営業 |
| 会話 | テレアポ担当者が1社（1名）の顧客と行う1回の電話 |
| 成果指標 | 会話の結果を表すカテゴリ（アポ獲得/資料送付/担当者接続/受付突破失敗） |
| 受付突破 | 受付担当者を経由して、キーパーソン（決裁権者、担当者）に電話を繋いでもらうこと |
| 改善点 | 失敗した会話において改善すべきポイント（冒頭トーク、クロージング等） |
| 話者分離 | 音声認識において、複数の話者を識別・区別する技術 |
| LLM | Large Language Model（大規模言語モデル）の略。Gemini等 |

---

## 13. 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|---------|-------|
| 1.0 | 2025-10-24 | 初版作成 | Kaisei Yamaguchi |

---

## 14. 承認

| 役割 | 氏名 | 日付 | 署名 |
|-----|-----|------|-----|
| プロダクトオーナー | | | |
| 開発リーダー | | | |

---

**以上**

